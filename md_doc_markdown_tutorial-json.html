<html lang="en">
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
		<meta name="description" content="FineFramework (FFW) is an open source framework written in C++ designed for developing applications." />
		<meta name="author" content="Matus Novak">
		<link rel="icon" href="favicon.ico">
		<title>FineFramework - Documentation</title>
		<!-- Bootstrap core CSS -->
		<link href="bootstrap.css" rel="stylesheet">
		<!-- Custom styles for this template -->
		<link href="docs.css" rel="stylesheet">
		<script type="text/javascript" src="jquery.min.js"></script>
		<script type="text/javascript" src="dynsections.js"></script>
	</head>
	<body>
		<nav class="navbar sticky-top navbar-toggleable-md navbar-light bg-faded">
		<div class="container">
		  <button class="navbar-toggler navbar-toggler-right" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
			<span class="navbar-toggler-icon"></span>
		  </button>
		  <a class="navbar-brand" href="index.html">
			<img src="logo.png" width="60" height="30" alt="">
		  </a>
		  <div class="collapse navbar-collapse" id="navbarSupportedContent">
			<ul class="navbar-nav mr-auto">
			  <li class="nav-item active"><a class="nav-link" href="index.html">Home <span class="sr-only">(current)</span></a></li>
			  <li class="nav-item"><a class="nav-link" href="modules.html">Documentation</a></li>
			  <li class="nav-item"><a class="nav-link" href="md_doc_markdown_tutorials.html">Tutorials</a></li>
			  <li class="nav-item"><a class="nav-link" href="md_doc_markdown_examples.html">Examples</a></li>
			  <li class="nav-item"><a class="nav-link" href="md_doc_markdown_faq.html">F.A.Q</a></li>
			  <li class="nav-item"><a class="nav-link" href="https://github.com/matusnovak/fineframework">GitHub</a></li>
			</ul>
			<form class="form-inline my-2 my-lg-0">
			  <a class="btn btn-outline-primary" href="md_doc_markdown_download.html" role="button">Download</a>
			</form>
		  </div>
		</div>
		</nav>
		<div class="container" id="main"><div><!-- Generated by Doxygen 1.8.11 -->
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Tutorial: Encode and decode JSON </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>This tutorial will explain how to decode and encode JSON structure.</p>
<p><b>The tutorial uses <a class="el" href="classffw_1_1_var.html">ffw::Var</a> which is essential in the following examples. You must read <a href="md_doc_markdown_tutorial-var.html">Var - JSON-like data structure</a> tutorial first!</b></p>
<p>Make sure you add <code>finedata</code> into your linker and add the following headers into your project:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="math_8h.html">ffw/math.h</a>&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="data_8h.html">ffw/data.h</a>&gt;</span></div></div><!-- fragment --><h3>Decode JSON the easy way</h3>
<p>When decoding a JSON, values are converted into C++ specific data types:</p>
<table class="doxtable">
<tr>
<th>JSON value </th><th>C++ data type  </th></tr>
<tr>
<td>{ } </td><td><a class="el" href="classffw_1_1_object.html">ffw::Object</a> </td></tr>
<tr>
<td>[ ] </td><td><a class="el" href="classffw_1_1_array.html">ffw::Array</a> </td></tr>
<tr>
<td>"string" </td><td><a class="el" href="classffw_1_1_var.html">ffw::Var</a> as std::string </td></tr>
<tr>
<td>123456 </td><td><a class="el" href="classffw_1_1_var.html">ffw::Var</a> as int </td></tr>
<tr>
<td>123.456e-10 </td><td><a class="el" href="classffw_1_1_var.html">ffw::Var</a> as float </td></tr>
<tr>
<td>true false </td><td><a class="el" href="classffw_1_1_var.html">ffw::Var</a> as bool </td></tr>
<tr>
<td>null </td><td><a class="el" href="classffw_1_1_var.html">ffw::Var</a> as std::nullptr_t </td></tr>
</table>
<p>The strings that contain unicode characters encoded as '\uXXXX' will be converted into UTF-8</p>
<p>Decoding can be done as the following:</p>
<div class="fragment"><div class="line"><a class="code" href="classffw_1_1_var.html">ffw::Var</a> json;</div><div class="line"><span class="keywordflow">try</span> {</div><div class="line">  json = <a class="code" href="group__data.html#gaeabaab29e38d304f9d27f24228e1c16e">ffw::decodeJson</a>(</div><div class="line">    <span class="stringliteral">&quot;{\&quot;menu\&quot;: {&quot;</span></div><div class="line">    <span class="stringliteral">&quot;  \&quot;id\&quot;: \&quot;file\&quot;,&quot;</span></div><div class="line">    <span class="stringliteral">&quot;  \&quot;value\&quot;: \&quot;File\&quot;,&quot;</span></div><div class="line">    <span class="stringliteral">&quot;  \&quot;popup\&quot;: {&quot;</span></div><div class="line">    <span class="stringliteral">&quot;     \&quot;menuitem\&quot;: [&quot;</span></div><div class="line">    <span class="stringliteral">&quot;       {\&quot;value\&quot;: \&quot;New\&quot;, \&quot;onclick\&quot;: \&quot;CreateNewDoc()\&quot;},&quot;</span></div><div class="line">    <span class="stringliteral">&quot;       {\&quot;value\&quot;: \&quot;Open\&quot;, \&quot;onclick\&quot;: \&quot;OpenDoc()\&quot;},&quot;</span></div><div class="line">    <span class="stringliteral">&quot;       {\&quot;value\&quot;: \&quot;Close\&quot;, \&quot;onclick\&quot;: \&quot;CloseDoc()\&quot;}&quot;</span></div><div class="line">    <span class="stringliteral">&quot;     ]&quot;</span></div><div class="line">    <span class="stringliteral">&quot;  }&quot;</span></div><div class="line">    <span class="stringliteral">&quot;}}&quot;</span></div><div class="line">  );</div><div class="line">} <span class="keywordflow">catch</span> (<a class="code" href="classffw_1_1_json_decode_exception.html">ffw::JsonDecodeException</a>&amp; e){</div><div class="line">  std::cerr &lt;&lt; <span class="stringliteral">&quot;Error while decoding JSON: &quot;</span> &lt;&lt; e.what() &lt;&lt; std::endl;</div><div class="line">  <span class="keywordflow">return</span>;</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keywordflow">try</span> {</div><div class="line">  <span class="comment">// Check if the root element is an object</span></div><div class="line">  std::cout &lt;&lt; json.<a class="code" href="classffw_1_1_var.html#ab777c90c26996e4e64522477115b641a">is</a>&lt;<a class="code" href="classffw_1_1_object.html">ffw::Object</a>&gt;() &lt;&lt; std::endl;</div><div class="line">  <span class="comment">// Prints: &quot;1&quot;</span></div><div class="line"></div><div class="line">  <span class="comment">// Access key (returns a reference)</span></div><div class="line">  std::cout &lt;&lt; json[<span class="stringliteral">&quot;menu&quot;</span>][<span class="stringliteral">&quot;id&quot;</span>].<a class="code" href="classffw_1_1_var.html#a2bf090fcd9d7005424773791ace72fe5">getAs</a>&lt;std::string&gt;() &lt;&lt; std::endl;</div><div class="line">  <span class="comment">// Prints: &quot;file&quot;</span></div><div class="line"></div><div class="line">  <span class="comment">// Exactly same as above, but returns a copy instead</span></div><div class="line">  std::cout &lt;&lt; json[<span class="stringliteral">&quot;menu&quot;</span>][<span class="stringliteral">&quot;id&quot;</span>].<a class="code" href="classffw_1_1_var.html#aaf0f0aaee62127213953a87e605aa8be">toString</a>() &lt;&lt; std::endl;</div><div class="line"></div><div class="line">  <span class="comment">// Exactly same as above:</span></div><div class="line">  std::cout &lt;&lt; json.<a class="code" href="classffw_1_1_var.html#a2bf090fcd9d7005424773791ace72fe5">getAs</a>&lt;<a class="code" href="classffw_1_1_object.html">ffw::Object</a>&gt;()[<span class="stringliteral">&quot;menu&quot;</span>].getAs&lt;ffw::Object&gt;()[<span class="stringliteral">&quot;id&quot;</span>].toString() &lt;&lt; std::endl;</div><div class="line">  <span class="comment">// In the previous example, using [&quot;key&quot;] on ffw::Var </span></div><div class="line">  <span class="comment">// will automatically call getAs&lt;ffw::Object&gt;()</span></div><div class="line">  <span class="comment">// Also, using [integer] on ffw::Var will do the same but will cast to ffw::Array</span></div><div class="line"></div><div class="line">  <span class="comment">// Access a chain of keys</span></div><div class="line">  std::cout &lt;&lt; json[<span class="stringliteral">&quot;menu&quot;</span>][<span class="stringliteral">&quot;popup&quot;</span>][<span class="stringliteral">&quot;menuitem&quot;</span>][2][<span class="stringliteral">&quot;value&quot;</span>].<a class="code" href="classffw_1_1_var.html#a2bf090fcd9d7005424773791ace72fe5">getAs</a>&lt;std::string&gt;() &lt;&lt; std::endl;</div><div class="line">  <span class="comment">// Prints: &quot;Close&quot;</span></div><div class="line"></div><div class="line">  <span class="comment">// Check if a specific value is array (can be used to detect int, float, etc...)</span></div><div class="line">  std::cout &lt;&lt; json[<span class="stringliteral">&quot;menu&quot;</span>][<span class="stringliteral">&quot;popup&quot;</span>][<span class="stringliteral">&quot;menuitem&quot;</span>].<a class="code" href="classffw_1_1_var.html#ab777c90c26996e4e64522477115b641a">is</a>&lt;<a class="code" href="classffw_1_1_array.html">ffw::Array</a>&gt;() &lt;&lt; std::endl;</div><div class="line">  <span class="comment">// Prints: &quot;1&quot;</span></div><div class="line"></div><div class="line">  <span class="comment">// Get a reference for easier access</span></div><div class="line">  <a class="code" href="classffw_1_1_array.html">ffw::Array</a>&amp; arr = json[<span class="stringliteral">&quot;menu&quot;</span>][<span class="stringliteral">&quot;popup&quot;</span>][<span class="stringliteral">&quot;menuitem&quot;</span>].<a class="code" href="classffw_1_1_var.html#a2bf090fcd9d7005424773791ace72fe5">getAs</a>&lt;<a class="code" href="classffw_1_1_array.html">ffw::Array</a>&gt;();</div><div class="line">  <span class="comment">// Would throw std::bad_cast if the menuitem is an object instead</span></div><div class="line"></div><div class="line">  <span class="comment">// Access a value from arr</span></div><div class="line">  std::cout &lt;&lt; arr[2][<span class="stringliteral">&quot;value&quot;</span>].getAs&lt;std::string&gt;() &lt;&lt; std::endl;</div><div class="line">  <span class="comment">// Prints: &quot;Close&quot;</span></div><div class="line"></div><div class="line">  <span class="comment">// Access an incorrect data type from arr</span></div><div class="line">  std::cout &lt;&lt; arr[2][<span class="stringliteral">&quot;value&quot;</span>].getAs&lt;<span class="keywordtype">int</span>&gt;() &lt;&lt; std::endl;</div><div class="line">  <span class="comment">// Throws std::bad_cast</span></div><div class="line">  <span class="comment">// Why? because 2nd menuitem&#39;s &quot;value&quot; inside of {&quot;value&quot;: &quot;Close&quot;, &quot;onclick&quot;: &quot;CloseDoc()&quot;}</span></div><div class="line">  <span class="comment">// is not an integer!</span></div><div class="line"></div><div class="line">  <span class="comment">// To use exceptions while getting keys, use at(&quot;key&quot;)</span></div><div class="line">  <span class="comment">// Throws std::out_of_range  !!!!</span></div><div class="line">  std::cout &lt;&lt; json.<a class="code" href="classffw_1_1_var.html#a2bf090fcd9d7005424773791ace72fe5">getAs</a>&lt;<a class="code" href="classffw_1_1_object.html">ffw::Object</a>&gt;().at(<span class="stringliteral">&quot;menu&quot;</span>).getAs&lt;<a class="code" href="classffw_1_1_object.html">ffw::Object</a>&gt;().at(<span class="stringliteral">&quot;invalid&quot;</span>).getAs&lt;std::string&gt;() &lt;&lt; std::endl;</div><div class="line"></div><div class="line">} <span class="keywordflow">catch</span> (std::exception&amp; e){</div><div class="line">  std::cerr &lt;&lt; <span class="stringliteral">&quot;Something went wrong while accessing data: &quot;</span> &lt;&lt; e.what() &lt;&lt; std::endl;</div><div class="line">}</div></div><!-- fragment --><p>Please note:</p>
<ul>
<li>If the decoding fails, an <a class="el" href="classffw_1_1_json_decode_exception.html">ffw::JsonDecodeException</a> is thrown</li>
<li>The [] operator with std::string assumes that you are trying to get <a class="el" href="classffw_1_1_object.html">ffw::Object</a></li>
<li>The [] operator with int assumes that you are trying to get <a class="el" href="classffw_1_1_array.html">ffw::Array</a></li>
</ul>
<h3>Encode JSON the easy way</h3>
<p>The following code is a simple way to create a data structure using <a class="el" href="classffw_1_1_var.html">ffw::Var</a> and encoding it as JSON. Note that an exception can be thrown if:</p>
<ul>
<li>the root node of the data structure is not object or array</li>
<li>any of the values contain invalid data type, only the following are valid: (<a class="el" href="classffw_1_1_object.html">ffw::Object</a>, <a class="el" href="classffw_1_1_array.html">ffw::Array</a>, any signed or unsigned integer, bool, std::string or const char*, any floating point). For example, you can not encode a C++ reference, or pointer, or class, etc...</li>
</ul>
<div class="fragment"><div class="line"><a class="code" href="classffw_1_1_object.html">ffw::Object</a> obj = { </div><div class="line">  <span class="stringliteral">&quot;menu&quot;</span>, <a class="code" href="classffw_1_1_object.html">ffw::Object</a>{</div><div class="line">    {<span class="stringliteral">&quot;id&quot;</span>, <span class="stringliteral">&quot;file&quot;</span>,},</div><div class="line">    {<span class="stringliteral">&quot;value&quot;</span>, <span class="stringliteral">&quot;File&quot;</span>,},</div><div class="line">    {<span class="stringliteral">&quot;popup&quot;</span>, <a class="code" href="classffw_1_1_object.html">ffw::Object</a>{</div><div class="line">      {<span class="stringliteral">&quot;menuitem&quot;</span>, <a class="code" href="classffw_1_1_array.html">ffw::Array</a>{</div><div class="line">        <a class="code" href="classffw_1_1_object.html">ffw::Object</a>{{<span class="stringliteral">&quot;value&quot;</span>, <span class="stringliteral">&quot;New&quot;</span>}, {<span class="stringliteral">&quot;onclick&quot;</span>, <span class="stringliteral">&quot;CreateNewDoc()&quot;</span>}},</div><div class="line">        <a class="code" href="classffw_1_1_object.html">ffw::Object</a>{{<span class="stringliteral">&quot;value&quot;</span>, <span class="stringliteral">&quot;Open&quot;</span>}, {<span class="stringliteral">&quot;onclick&quot;</span>, <span class="stringliteral">&quot;OpenDoc()&quot;</span>}},</div><div class="line">        <a class="code" href="classffw_1_1_object.html">ffw::Object</a>{{<span class="stringliteral">&quot;value&quot;</span>, <span class="stringliteral">&quot;Close&quot;</span>}, {<span class="stringliteral">&quot;onclick&quot;</span>, <span class="stringliteral">&quot;CloseDoc()&quot;</span>}}</div><div class="line">      }},</div><div class="line">    }},</div><div class="line">  } </div><div class="line">};</div><div class="line"></div><div class="line"><span class="keywordflow">try</span> {</div><div class="line">  std::string str = <a class="code" href="group__data.html#gae03a274408dab0065f4cf960f4e8d398">ffw::encodeJson</a>(obj, <span class="stringliteral">&quot;    &quot;</span>, <span class="keyword">false</span>);</div><div class="line">  <span class="comment">// If you wish to create compact JSON (no new lines, no indent)</span></div><div class="line">  <span class="comment">// pass NULL as a second parameter!</span></div><div class="line">  <span class="comment">// To escape UTF-8 into unicode \uXXXX symbols, pass &#39;true&#39;</span></div><div class="line">  <span class="comment">// as a third parameter</span></div><div class="line"></div><div class="line">} <span class="keywordflow">catch</span> (<a class="code" href="classffw_1_1_json_encode_exception.html">ffw::JsonEncodeException</a>&amp; e){</div><div class="line">  std::cerr &lt;&lt; <span class="stringliteral">&quot;Something went wrong: &quot;</span> &lt;&lt; e.what() &lt;&lt; std::endl;</div><div class="line">  <span class="keywordflow">return</span>;</div><div class="line">}</div><div class="line"><span class="comment">// To encode JSON in more compact way (no indent, no new lines) </span></div><div class="line"><span class="comment">// replace second parameter with NULL</span></div></div><!-- fragment --><p>Will create the following equivalent JSON structure:</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;{&quot;menu&quot;: {</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;  &quot;id&quot;: &quot;file&quot;,</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;  &quot;value&quot;: &quot;File&quot;,</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;  &quot;popup&quot;: {</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;    &quot;menuitem&quot;: [</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;      {&quot;value&quot;: &quot;New&quot;, &quot;onclick&quot;: &quot;CreateNewDoc()&quot;},</div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;      {&quot;value&quot;: &quot;Open&quot;, &quot;onclick&quot;: &quot;OpenDoc()&quot;},</div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;      {&quot;value&quot;: &quot;Close&quot;, &quot;onclick&quot;: &quot;CloseDoc()&quot;}</div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;    ]</div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;  }</div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;}}</div></div><!-- fragment --><p>Please note:</p>
<ul>
<li>Characters such as new-line, quote, apostrophe, cariage-return will be escaped into '\n', '\"', '\'', '\r' and so on.</li>
</ul>
<h3>Decode JSON the complicated way</h3>
<p>With this method, you can decode JSON by step by step without using <a class="el" href="classffw_1_1_var.html">ffw::Var</a> at all. It grants you the freedom you need. Any of the following commands (except constructor!) can throw <a class="el" href="classffw_1_1_json_decode_exception.html">ffw::JsonDecodeException</a> at any time if the JSON string is broken in any way. Exception is thrown if:</p>
<ul>
<li>JSON syntax error</li>
<li>Unpexpected control or reserved character (for example \p does not exist, but \n \t etc are all good)</li>
<li>trying to cast from into c++ data type when the JSON value is something completely else (for example, JSON value is clearly a string: "key": "Hello World!" but you try to use value.toInteger() when clearly value.isInteger() gives you false)</li>
</ul>
<p>Also, note that there is difference between integer, number, float:</p>
<ul>
<li><a class="el" href="classffw_1_1_json_reader_1_1_node.html#a741d5374a7544f4701accce6b5e4cd26">ffw::JsonReader::Node::isNumber</a> returns true if the JSON value is any kind of number (integer or float)</li>
<li><a class="el" href="classffw_1_1_json_reader_1_1_node.html#a939690e54f17813f10ebf4d889efc118">ffw::JsonReader::Node::isInteger</a> returns true if the number is not floating point (no decimal point)</li>
<li><a class="el" href="classffw_1_1_json_reader_1_1_node.html#a4fdf6f974c0751ad57d6dfe14e16ef71">ffw::JsonReader::Node::isFloat</a> returns true if the number is floating point (has decimal point)</li>
</ul>
<div class="fragment"><div class="line"><a class="code" href="classffw_1_1_json_reader.html">ffw::JsonReader</a> json(</div><div class="line">  <span class="stringliteral">&quot;{\&quot;menu\&quot;: {&quot;</span></div><div class="line">  <span class="stringliteral">&quot;  \&quot;id\&quot;: \&quot;file\&quot;,&quot;</span></div><div class="line">  <span class="stringliteral">&quot;  \&quot;value\&quot;: \&quot;File\&quot;,&quot;</span></div><div class="line">  <span class="stringliteral">&quot;  \&quot;popup\&quot;: {&quot;</span></div><div class="line">  <span class="stringliteral">&quot;   \&quot;menuitem\&quot;: [&quot;</span></div><div class="line">  <span class="stringliteral">&quot;     {\&quot;value\&quot;: \&quot;New\&quot;, \&quot;onclick\&quot;: \&quot;CreateNewDoc()\&quot;},&quot;</span></div><div class="line">  <span class="stringliteral">&quot;     {\&quot;value\&quot;: \&quot;Open\&quot;, \&quot;onclick\&quot;: \&quot;OpenDoc()\&quot;},&quot;</span></div><div class="line">  <span class="stringliteral">&quot;     {\&quot;value\&quot;: \&quot;Close\&quot;, \&quot;onclick\&quot;: \&quot;CloseDoc()\&quot;}&quot;</span></div><div class="line">  <span class="stringliteral">&quot;   ]&quot;</span></div><div class="line">  <span class="stringliteral">&quot;  }&quot;</span></div><div class="line">  <span class="stringliteral">&quot;}}&quot;</span></div><div class="line">);</div><div class="line"></div><div class="line"><span class="keywordflow">try</span> {</div><div class="line">  <a class="code" href="classffw_1_1_json_reader_1_1_node.html">ffw::JsonReader::Node</a> value, key;</div><div class="line"></div><div class="line">  <span class="comment">// Find next available child node, in this case the root element</span></div><div class="line">  json.getNext(&amp;value, &amp;key);</div><div class="line">  <span class="comment">// key remains unmodified as the root node has no key, only a value: {}</span></div><div class="line"></div><div class="line">  <span class="comment">// Go inside the root node</span></div><div class="line">  json.stepInto(&amp;value);</div><div class="line">  json.getCurrentType(); <span class="comment">// Returns ffw::JsonReader::Type::OBJECT</span></div><div class="line"></div><div class="line">  <span class="comment">// Find &quot;menu&quot; node</span></div><div class="line">  json.getNext(&amp;value, &amp;key);</div><div class="line">  std::cout &lt;&lt; key.<a class="code" href="classffw_1_1_json_reader_1_1_node.html#ad8629fdeeebbd23c0514be98b3aa79a8">toString</a>() &lt;&lt; std::endl; <span class="comment">// Prints: &quot;menu&quot;</span></div><div class="line">  value.<a class="code" href="classffw_1_1_json_reader_1_1_node.html#a67b95625b7d22e6699235e6b98b46f51">isObject</a>(); <span class="comment">// Returns true</span></div><div class="line"></div><div class="line">  <span class="comment">// Go inside the &quot;menu&quot; node</span></div><div class="line">  json.stepInto(&amp;value);</div><div class="line">  json.getCurrentType(); <span class="comment">// Returns ffw::JsonReader::Type::OBJECT</span></div><div class="line"></div><div class="line">  <span class="comment">// Find &quot;id&quot; node</span></div><div class="line">  json.getNext(&amp;value, &amp;key);</div><div class="line">  std::cout &lt;&lt; key.<a class="code" href="classffw_1_1_json_reader_1_1_node.html#ad8629fdeeebbd23c0514be98b3aa79a8">toString</a>() &lt;&lt; std::endl; <span class="comment">// Prints: &quot;id&quot;</span></div><div class="line">  value.<a class="code" href="classffw_1_1_json_reader_1_1_node.html#a3ef88585d37ddcda68dbccd378b44b77">isString</a>(); <span class="comment">// Returns true</span></div><div class="line">  value.<a class="code" href="classffw_1_1_json_reader_1_1_node.html#a939690e54f17813f10ebf4d889efc118">isInteger</a>(); <span class="comment">// Returns false</span></div><div class="line"></div><div class="line">  <span class="comment">// Find &quot;value&quot;</span></div><div class="line">  json.getNext(&amp;value, &amp;key);</div><div class="line">  std::cout &lt;&lt; key.<a class="code" href="classffw_1_1_json_reader_1_1_node.html#ad8629fdeeebbd23c0514be98b3aa79a8">toString</a>() &lt;&lt; std::endl; <span class="comment">// Prints: &quot;value&quot;</span></div><div class="line"></div><div class="line">  <span class="comment">// Find &quot;popup&quot;</span></div><div class="line">  json.getNext(&amp;value, &amp;key);</div><div class="line">  std::cout &lt;&lt; key.<a class="code" href="classffw_1_1_json_reader_1_1_node.html#ad8629fdeeebbd23c0514be98b3aa79a8">toString</a>() &lt;&lt; std::endl; <span class="comment">// Prints: &quot;popup&quot;</span></div><div class="line"></div><div class="line">  <span class="comment">// No next node... Returns FALSE!</span></div><div class="line">  <span class="comment">// The value and key remains unmodified</span></div><div class="line">  json.getNext(&amp;value, &amp;key);</div><div class="line"></div><div class="line">  <span class="comment">// Step inside of &quot;popup&quot;</span></div><div class="line">  json.stepInto(&amp;value);</div><div class="line">  json.getCurrentType(); <span class="comment">// Returns ffw::JsonReader::Type::OBJECT</span></div><div class="line"></div><div class="line">  <span class="comment">// Find &quot;menuitem&quot;</span></div><div class="line">  json.getNext(&amp;value, &amp;key);</div><div class="line">  std::cout &lt;&lt; key.<a class="code" href="classffw_1_1_json_reader_1_1_node.html#ad8629fdeeebbd23c0514be98b3aa79a8">toString</a>() &lt;&lt; std::endl; <span class="comment">// Prints: &quot;menuitem&quot;</span></div><div class="line">  value.<a class="code" href="classffw_1_1_json_reader_1_1_node.html#ab2e7e5adeb331bfd0cd19ade1d387af6">isArray</a>(); <span class="comment">// Returns true</span></div><div class="line"></div><div class="line">  <span class="comment">// Step inside of &quot;menuitem&quot;</span></div><div class="line">  json.stepInto(&amp;value);</div><div class="line">  json.getCurrentType(); <span class="comment">// Returns ffw::JsonReader::Type::ARRAY</span></div><div class="line"></div><div class="line">  <span class="comment">// Get next available node</span></div><div class="line">  <span class="comment">// Becuase we are inside of an array, the key remains unmodified!</span></div><div class="line">  json.getNext(&amp;value, &amp;key);</div><div class="line">  <span class="comment">// json.getNext(&amp;value, NULL); // You can pass NULL as a second parameter</span></div><div class="line"></div><div class="line">  <span class="comment">// Step inside the first node</span></div><div class="line">  json.stepInto(&amp;value);</div><div class="line">  json.getCurrentType(); <span class="comment">// Returns ffw::JsonReader::Type::OBJECT</span></div><div class="line"></div><div class="line">  <span class="comment">// Find first value, in this case it is &quot;value&quot;</span></div><div class="line">  json.getNext(&amp;value, &amp;key);</div><div class="line">  std::cout &lt;&lt; key.<a class="code" href="classffw_1_1_json_reader_1_1_node.html#ad8629fdeeebbd23c0514be98b3aa79a8">toString</a>() &lt;&lt; std::endl; <span class="comment">// Prints: &quot;value&quot;</span></div><div class="line">  value.<a class="code" href="classffw_1_1_json_reader_1_1_node.html#a3ef88585d37ddcda68dbccd378b44b77">isString</a>(); <span class="comment">// Returns true</span></div><div class="line">  std::cout &lt;&lt; value.<a class="code" href="classffw_1_1_json_reader_1_1_node.html#ad8629fdeeebbd23c0514be98b3aa79a8">toString</a>() &lt;&lt; std::endl; <span class="comment">// Prints: &quot;New&quot;</span></div><div class="line"></div><div class="line">  <span class="comment">// Go back one level up...</span></div><div class="line">  json.stepOut();</div><div class="line">  <span class="comment">// We are back inside of &quot;menuitem&quot; array</span></div><div class="line">  <span class="comment">// The next call of getNext() will return value </span></div><div class="line">  <span class="comment">// pointing to {&quot;value&quot;: &quot;Open&quot;, &quot;onclick&quot;: &quot;OpenDoc()&quot;}</span></div><div class="line">  <span class="comment">// Calling the getNext() would then return the last object in the array.</span></div><div class="line">  <span class="comment">// If you call it once more time, it will return false as there is nothing left.</span></div><div class="line">  <span class="comment">// You can then use json.stepOut() to get back to the &quot;popup&quot; node.</span></div><div class="line">} <span class="keywordflow">catch</span> (<a class="code" href="classffw_1_1_json_decode_exception.html">ffw::JsonDecodeException</a>&amp; e){</div><div class="line">  std::cerr &lt;&lt; <span class="stringliteral">&quot;Something went wrong: &quot;</span> &lt;&lt; e.what() &lt;&lt; std::endl;</div><div class="line">}</div></div><!-- fragment --><h3>Encode JSON the complicated way</h3>
<p>This method si very similar to the one above and again, it does not use <a class="el" href="classffw_1_1_var.html">ffw::Var</a> at all. An exception is thrown if:</p>
<ul>
<li>adding a node into an object with NULL key</li>
<li>you call xml.stepOut() too many times</li>
<li>when there has been an error with the stream</li>
</ul>
<p><a class="el" href="classffw_1_1_json_writer.html">ffw::JsonWriter</a> supports arbitary stream, you can create one based on <a class="el" href="classffw_1_1_json_writer_1_1_stream.html">ffw::JsonWriter::Stream</a> when you override one simple method. However, <a class="el" href="classffw_1_1_json_writer_1_1_string_stream.html">ffw::JsonWriter::StringStream</a> and <a class="el" href="classffw_1_1_json_writer_1_1_file_stream.html">ffw::JsonWriter::FileStream</a> are provided to you.</p>
<div class="fragment"><div class="line"><span class="keywordflow">try</span> {</div><div class="line">  <a class="code" href="classffw_1_1_json_writer_1_1_string_stream.html">ffw::JsonWriter::StringStream</a> stream;</div><div class="line">  <a class="code" href="classffw_1_1_json_writer.html">ffw::JsonWriter</a> json(&amp;stream, <span class="stringliteral">&quot;    &quot;</span>, <span class="keyword">false</span>);</div><div class="line">  <span class="comment">// If you wish to create compact JSON (no new lines, no indent)</span></div><div class="line">  <span class="comment">// pass NULL as a second parameter!</span></div><div class="line">  <span class="comment">// To escape UTF-8 into unicode \uXXXX symbols, pass &#39;true&#39;</span></div><div class="line">  <span class="comment">// as a third parameter</span></div><div class="line"></div><div class="line">  <span class="comment">// The root object, has no key!</span></div><div class="line">  json.addObject(NULL);</div><div class="line"></div><div class="line">  <span class="comment">// Add menu object</span></div><div class="line">  json.addObject(<span class="stringliteral">&quot;menu&quot;</span>);</div><div class="line">  json.addString(<span class="stringliteral">&quot;file&quot;</span>, <span class="stringliteral">&quot;id&quot;</span>);</div><div class="line">  json.addString(<span class="stringliteral">&quot;File&quot;</span>, <span class="stringliteral">&quot;value&quot;</span>);</div><div class="line"></div><div class="line">  <span class="comment">// Add popup object</span></div><div class="line">  json.addObject(<span class="stringliteral">&quot;popup&quot;</span>);</div><div class="line"></div><div class="line">  <span class="comment">// Add menuitem array</span></div><div class="line">  json.addArray(<span class="stringliteral">&quot;menuitem&quot;</span>);</div><div class="line"></div><div class="line">  <span class="comment">// Add first object</span></div><div class="line">  json.addObject(NULL); <span class="comment">// Key is being ignored inside of array</span></div><div class="line">  json.addString(<span class="stringliteral">&quot;New&quot;</span>, <span class="stringliteral">&quot;value&quot;</span>);</div><div class="line">  json.addString(<span class="stringliteral">&quot;CreateNewDoc()&quot;</span>, <span class="stringliteral">&quot;onclick&quot;</span>);</div><div class="line">  json.stepOut(); <span class="comment">// Finish object</span></div><div class="line"></div><div class="line">  <span class="comment">// Add second object</span></div><div class="line">  json.addObject(NULL); <span class="comment">// Key is being ignored inside of array</span></div><div class="line">  json.addString(<span class="stringliteral">&quot;Open&quot;</span>, <span class="stringliteral">&quot;value&quot;</span>);</div><div class="line">  json.addString(<span class="stringliteral">&quot;OpenDoc()&quot;</span>, <span class="stringliteral">&quot;onclick&quot;</span>);</div><div class="line">  json.stepOut(); <span class="comment">// Finish object</span></div><div class="line"></div><div class="line">  <span class="comment">// Add third object</span></div><div class="line">  json.addObject(NULL); <span class="comment">// Key is being ignored inside of array</span></div><div class="line">  json.addString(<span class="stringliteral">&quot;Close&quot;</span>, <span class="stringliteral">&quot;value&quot;</span>);</div><div class="line">  json.addString(<span class="stringliteral">&quot;CloseDoc()&quot;</span>, <span class="stringliteral">&quot;onclick&quot;</span>);</div><div class="line">  json.stepOut(); <span class="comment">// Finish object</span></div><div class="line"></div><div class="line">  <span class="comment">// To properly finish decoding, we have to step back up to the root!</span></div><div class="line">  <span class="comment">// Otherwise the output would be invalid!</span></div><div class="line">  json.stepOut(); <span class="comment">// We are back at the &quot;menuitem&quot; array, close it</span></div><div class="line">  json.stepOut(); <span class="comment">// We are back at the &quot;popup&quot; object, close it</span></div><div class="line">  json.stepOut(); <span class="comment">// We are back at the &quot;menu&quot; object, close it</span></div><div class="line">  json.stepOut(); <span class="comment">// We are back at the the root, close it</span></div><div class="line">  <span class="comment">// We are done!</span></div><div class="line"></div><div class="line">  <span class="comment">// Any further call to json.stepOut() would result in exception</span></div><div class="line"></div><div class="line">  std::cout &lt;&lt; stream.<a class="code" href="classffw_1_1_json_writer_1_1_string_stream.html#a7262c60a4420b41dd4a3cbe93d6ad1f7">get</a>() &lt;&lt; std::endl;</div><div class="line">} <span class="keywordflow">catch</span> (<a class="code" href="classffw_1_1_json_encode_exception.html">ffw::JsonEncodeException</a>&amp; e){</div><div class="line">  std::cerr &lt;&lt; <span class="stringliteral">&quot;Something went wrong: &quot;</span> &lt;&lt; e.what() &lt;&lt; std::endl;</div><div class="line">}</div></div><!-- fragment --><p>Creates the following JSON structure:</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;{</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;    &quot;menu&quot;:{</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;        &quot;id&quot;:&quot;file&quot;,</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;        &quot;value&quot;:&quot;File&quot;,</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;        &quot;popup&quot;:{</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;            &quot;menuitem&quot;:[</div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;                {</div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;                    &quot;value&quot;:&quot;New&quot;,</div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;                    &quot;onclick&quot;:&quot;CreateNewDoc()&quot;</div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;                },</div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;                {</div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;                    &quot;value&quot;:&quot;Open&quot;,</div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;                    &quot;onclick&quot;:&quot;OpenDoc()&quot;</div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;                },</div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;                {</div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;                    &quot;value&quot;:&quot;Close&quot;,</div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;                    &quot;onclick&quot;:&quot;CloseDoc()&quot;</div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;                }</div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;            ]</div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;        }</div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;    }</div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;}</div></div><!-- fragment --> </div></div><!-- contents -->
	</div>
	<script src="tether.min.js"></script>
	<script src="bootstrap.min.js"></script>
	</body>
</html>